<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criador de Cart√µes Estilo RPG</title>
    <!-- Adicionando a fonte Inter do Google Fonts -->
    <link href="https://fonts.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
    <!-- Adicionando o Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    
    <style>
        .divPartculas h2 {
            font-size: 2em;
            margin: 0 0 10px;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.3);
        }

        .divPartculas p {
            font-size: 1em;
        }

        /* Estilo para as part√≠culas douradas */
        .sparkle {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            z-index: 0; 
            animation: disperse var(--duration) forwards; 
        }
        
        @keyframes disperse {
            0% {
                transform: translate(0, 0) scale(1) rotate(0deg);
                opacity: .3;
            }
            100% {
                transform: translate(var(--x), var(--y)) scale(0) rotate(var(--r));
                opacity: 0;
            }
        }
        .back-content{
            width: 100%;
            height: calc(100% - 30px);
            margin: 15px;
            border-radius: 7px;
        }
        .card-3d-container {
            perspective: 1500px; 
            width: 100%;
            height: 600px;
        }

        .card-3d {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d; 
            transition: transform 0.6s;
            cursor: pointer;
            
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden; 
            border-radius: 20px;
            box-shadow: 0px 0px 6px 0px #0f1908;
        }

        .card-back {
            transform: rotateY(180deg); 
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .rpg-card .ex-max
        {
            background-size: cover;
            background-blend-mode: multiply;
        }
    
        .rpg-card:fullscreen .card-3d-container{ width: 90%;}
        .rpg-card:fullscreen .ex-max, .rpg-card:fullscreen .card-3d-container
        {
            display: flex;
            border-radius: 10px;
            justify-content: center;
            background-size: cover !important;
        }

        .rpg-card:fullscreen .img-max
        {
            width: 200px !important;
            height: 200px;
            position: absolute;
            left: 0;
            right: 0;
            margin: auto;
        }

        .rpg-card:fullscreen .img-max img
        {
            width: 100%;
            height: 100%;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to bottom right, #f3f4f6, #e5e7eb);
        }
        input:focus, textarea:focus {
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.5);
            border-color: #8b5cf6;
            outline: none;
        }
        .btn-gradient-pulse {
            background-size: 200% 200%;
            animation: pulse-gradient 2s linear infinite;
        }
        @keyframes pulse-gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .rpg-card {
            background-image: url('https://placehold.co/400x600/1e293b/d1d5db?text=Fundo+do+Cart√£o');
            background-size: cover;
            background-position: center;
            border: 4px solid #1f2937;
            position: relative;
        }
        .rpg-card-frame {
            backdrop-filter: blur(8px);
            border: 2px solid var(--border-color, #4b5563);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease-in-out;
            background-color: var(--card-bg-color, rgba(31, 41, 55, 0.9));
            color: var(--text-color, #f3f4f6);
            width: 100%;
        }
        .rpg-card:fullscreen {
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
            border: 0;
            border-radius: 0;
            background-size: cover;
            background-blend-mode: multiply;
        }
        .rpg-card:fullscreen .rpg-card-frame {
            max-width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .rpg-card:fullscreen button, .rpg-card:fullscreen .swiper-navigation {
            display: none;
        }
        .rpg-card-title-divider {
            height: 2px;
            width: 80%;
            background: linear-gradient(to right, transparent, var(--border-color, #6b7280), transparent);
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .rpg-card-stat-divider {
            height: 1px;
            width: 100%;
            background-color: var(--border-color, #4b5563);
        }
        .file-upload-input {
            width: 100%;
            padding: 0.5rem 1rem;
            margin-top: 0.25rem;
            background-color: #4b5563;
            color: white;
            border-radius: 0.5rem;
            border: 1px solid #4b5563;
            transition-property: all;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 200ms;
        }
        .file-upload-input:hover {
            border-color: #6b7280; 
        }
        .file-upload-input::-webkit-file-upload-button {
            background-color: #6366f1; 
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 9999px;
            font-weight: 600;
            margin-right: 1rem;
            cursor: pointer;
        }
        .file-upload-input::-webkit-file-upload-button:hover {
            background-color: #4f46e5;
        }
        .swiper-button-next:after, .swiper-button-prev:after {
            color: #4f46e5;
        }
        .swiper-slide {
            display: flex;
            justify-content: center;
        }
        small {
            position: absolute;
            left: -10px;
            top: -10px;            
            padding: 5px;
            border-radius: 50px;
            font-size: 11px !important;
            width: 30px;
            height: 30px;
            display: flex;            
            align-items: center;
            justify-content: center;            
            transform: scale(0.8);
        }
        #thumbnail-list {
            max-height: 8rem;
            overflow: scroll;
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;            
            justify-content: flex-start;
            background-color: rgb(30 41 59 / var(--tw-bg-opacity, 1));
        }

        /* ESTILOS DA TELA DE SPLASH PERSONALIZADA */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #1f2937;
            color: #f3f4f6;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 1s ease-in-out;
        }

        .splash-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-icon {
            animation: spin-pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes spin-pulse {
            0% { transform: rotate(0deg); opacity: 1; }
            50% { transform: rotate(180deg); opacity: 0.8; }
            100% { transform: rotate(360deg); opacity: 1; }
        }

        .progress-bar-container {
            width: 80%;
            max-width: 400px;
            height: 12px;
            background-color: #374151;
            border-radius: 6px;
            margin-top: 20px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.4);
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            transition: width 0.5s ease-in-out;
            box-shadow: 0 0 10px #8b5cf6, 0 0 5px #6366f1;
        }

        .progress-text {
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }

         .stat-fill {
            height: 100%;
            background-color: #eab308;
            border-radius: 9999px;
            transition: width 0.5s ease-in-out;
        }
         
        .stat-bar {
            background-color: #4a5568;
            border-radius: 9999px;
            height: 8px;
            margin-top: 0.25rem;
            position: relative;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-2">

    <!-- Tela de Splash Personalizada -->
    <div id="splashScreen" class="splash-screen divPartculas">
        <!-- √çcone SVG de carregamento (miniatura de cart√£o) -->
        <svg xmlns="http://www.w3.org/2000/svg" class="loading-icon text-indigo-400 w-20 h-20" viewBox="0 0 24 24" fill="currentColor">
            <!-- Card Outline -->
            <rect x="5" y="2" width="14" height="20" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="2"/>
            <!-- Card Symbol (Star) -->
            <path d="M12 7.74l1.39 2.82 3.12.45-2.26 2.2.53 3.11-2.78-1.46-2.78 1.46.53-3.11-2.26-2.2 3.12-.45L12 7.74z" fill="currentColor"/>
        </svg>
        <h1 class="text-3xl font-bold mt-4">Forjando Cart√µes...</h1>
        <div class="progress-bar-container">
            <div id="progressBar" class="progress-bar"></div>
        </div>
        <p id="progressText" class="text-sm mt-2 font-medium progress-text">Preparando...</p>
        <div class="divPartculas absolute inset-0"></div>
    </div>

    <!-- Conte√∫do Principal (Inicialmente escondido) -->
    <div id="mainContent" class="w-full max-w-5xl hidden">
        <!-- T√≠tulo principal -->
        <header class="text-center my-8">
            <h1 class="text-4xl font-bold text-gray-800">Crie seus pr√≥prios Cart√µes</h1>
            <p class="text-lg text-gray-600 mt-2">Personalize e adicione novos cart√µes √† sua cole√ß√£o.</p>
        </header>

        <!-- Se√ß√£o do formul√°rio para criar/editar cart√µes -->
        <div class="bg-slate-800 text-white p-4 rounded-3xl shadow-2xl mb-8">
            <h2 class="text-2xl font-bold mb-6 text-indigo-300">Novo Cart√£o</h2>
            <form id="cardForm" class="space-y-6">
                <div>
                    <label for="cardTitle" class="block text-sm font-semibold mb-1">Nome</label>
                    <input type="text" id="cardTitle" placeholder="Ex: Guerreiro Lend√°rio" required
                           class="w-full px-4 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 transition-colors duration-200">
                </div>
                <div>
                    <label for="cardSubTitle" class="block text-sm font-semibold mb-1">Ra√ßa e Classe</label>
                    <input type="text" id="cardSubTitle" placeholder="Ex: Humano Mago" required
                           class="w-full px-4 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 transition-colors duration-200">
                </div>
                <div>
                    <label for="cardLevel" class="block text-sm font-semibold mb-1">N√≠vel</label>
                    <input type="number" id="cardLevel" placeholder="1" required
                           class="w-full px-4 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 transition-colors duration-200">
                </div>

                <!-- Se√ß√£o para upload da imagem do personagem com pr√©-visualiza√ß√£o -->
                <div>
                    <h3 class="text-xl font-bold text-indigo-300 mb-2">Imagem do Personagem</h3>
                    <div class="mt-4 text-center">
                        <label for="characterImageUpload" class="block text-sm font-semibold mb-1 cursor-pointer">
                            Fa√ßa upload de uma imagem do seu PC:
                        </label>
                        <input type="file" id="characterImageUpload" accept="image/*" class="file-upload-input">
                        <img id="characterImagePreview" class="mt-4 mx-auto w-32 h-32 object-cover rounded-full border-4 border-gray-600 hidden" alt="Pr√©-visualiza√ß√£o do Personagem">
                    </div>
                </div>

                <!-- Se√ß√£o para upload da imagem de fundo com pr√©-visualiza√ß√£o -->
                <div>
                    <h3 class="text-xl font-bold text-indigo-300 mb-2">Imagem de Fundo</h3>
                    <div class="mt-4 text-center">
                        <label for="backgroundImageUpload" class="block text-sm font-semibold mb-1 cursor-pointer">
                            Fa√ßa upload de uma imagem do seu PC:
                        </label>
                        <input type="file" id="backgroundImageUpload" accept="image/*" class="file-upload-input">
                        <div id="backgroundImagePreview" class="mt-4 mx-auto w-full h-48 rounded-lg border-4 border-gray-600 hidden bg-cover bg-center"></div>
                    </div>
                </div>
                
                <!-- Se√ß√£o para Atributos -->
                <div class="grid grid-cols-2 gap-4">
                    <h3 class="col-span-2 text-xl font-bold text-indigo-300">Atributos</h3>
                    <div>
                        <label for="vida" class="block text-sm font-semibold mb-1">Vida (PV)</label>
                        <input type="number" id="vida" placeholder="1" class="w-full px-4 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 transition-colors duration-200">
                    </div>
                    <div>
                        <label for="mana" class="block text-sm font-semibold mb-1">Mana (PM)</label>
                        <input type="number" id="mana" placeholder="1" class="w-full px-4 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 transition-colors duration-200">
                    </div>
                    <div>
                        <label for="agilidade" class="block text-sm font-semibold mb-1">Agilidade (AGI)</label>
                        <input type="number" id="agilidade" placeholder="1" class="w-full px-4 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 transition-colors duration-200">
                    </div>
                    <div>
                        <label for="carisma" class="block text-sm font-semibold mb-1">Carisma (CAR)</label>
                        <input type="number" id="carisma" placeholder="1" class="w-full px-4 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 transition-colors duration-200">
                    </div>
                    <div>
                        <label for="forca" class="block text-sm font-semibold mb-1">For√ßa (FOR)</label>
                        <input type="number" id="forca" placeholder="1" class="w-full px-4 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 transition-colors duration-200">
                    </div>
                    <div>
                        <label for="inteligencia" class="block text-sm font-semibold mb-1">Intelig√™ncia (INT)</label>
                        <input type="number" id="inteligencia" placeholder="1" class="w-full px-4 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 transition-colors duration-200">
                    </div>
                    <div>
                        <label for="sabedoria" class="block text-sm font-semibold mb-1">Sabedoria (SAB)</label>
                        <input type="number" id="sabedoria" placeholder="1" class="w-full px-4 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 transition-colors duration-200">
                    </div>
                    <div>
                        <label for="vigor" class="block text-sm font-semibold mb-1">Vigor (VIG)</label>
                        <input type="number" id="vigor" placeholder="1" class="w-full px-4 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 transition-colors duration-200">
                    </div>
                </div>
                <!-- Se√ß√£o para Per√≠cias com checkboxes din√¢micos -->
                <div>
                    <h3 class="text-xl font-bold text-indigo-300 mb-2">Per√≠cias</h3>
                    <div id="pericias-checkboxes-container" class="space-y-2">
                        <!-- Checkboxes de per√≠cias ser√£o injetados aqui via JS -->
                    </div>
                    <div id="pericia-description-display" class="mt-4 p-4 rounded-lg bg-gray-700 hidden">
                        <h4 id="periciaDescriptionTitle" class="font-bold text-indigo-300"></h4>
                        <p id="periciaDescriptionText" class="text-sm text-gray-300 mt-2"></p>
                    </div>
                </div>
                <button type="submit" id="submitButton"
                        class="w-full py-3 px-4 rounded-full text-lg font-bold text-white bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 focus:outline-none transition duration-300 ease-in-out transform hover:scale-105 shadow-xl btn-gradient-pulse">
                    Criar Cart√£o
                </button>
            </form>
        </div>
        
        <!-- Lista de miniaturas para carregamento -->
        <h2 class="text-2xl font-bold text-gray-800 text-center mt-12 mb-4">Seus Cart√µes Salvos</h2>
        <div id="thumbnail-list" class="flex flex-wrap justify-center gap-4 p-4 bg-gray-100 rounded-xl shadow-inner mb-8">
            <p class="text-gray-500">Nenhum cart√£o salvo ainda. Crie um para come√ßar!</p>
        </div>

        <!-- Carrossel de cart√µes -->
        <div class="cards-container w-full max-w-lg mx-auto mb-1">
            <h2 class="text-2xl font-bold text-gray-800 text-center mb-4">Visualiza√ß√£o dos Cart√µes</h2>
            <div class="swiper mySwiper">
                <div class="swiper-wrapper" id="cardsContainer" >
                    <!-- Cards ser√£o injetados aqui -->
                </div>
                <!-- Bot√µes de navega√ß√£o do Swiper -->
                <div class="swiper-button-next" style="opacity: 0;"></div>
                <div class="swiper-button-prev" style="opacity: 0;"></div>
            </div>
        </div>
    </div>

    <!-- Script do Swiper -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <script>
        function part() {
            const divsParticulas = document.querySelectorAll('.divPartculas');
            divsParticulas.forEach(divParticulas => {
                const estilos = window.getComputedStyle(divParticulas);
                const maxParticles = 80;
                let currentParticles = 0;

                function createSparkle() {
                    if (currentParticles >= maxParticles) return;
                    const sparkle = document.createElement('div');
                    sparkle.classList.add('sparkle');
                    divParticulas.appendChild(sparkle);
                    currentParticles++;

                    const rect = divParticulas.getBoundingClientRect();
                    const spawnX = Math.random() * rect.width;
                    const spawnY = Math.random() * rect.height;

                    sparkle.style.opacity = (0.1 + Math.random() * 0.4).toFixed(2);
                    sparkle.style.left = `${spawnX}px`;
                    sparkle.style.top = `${spawnY}px`;
                    sparkle.style.backgroundColor = `${estilos.borderColor}`;
                    sparkle.style.boxShadow = `0 0 5px 2px ${estilos.borderColor}, 0 0 10px 4px ${estilos.borderColor}`;

                    const size = Math.random() * 1.5 + 0.5;
                    sparkle.style.width = `${size}px`;
                    sparkle.style.height = `${size}px`;

                    const directionX = (spawnX - rect.width / 2) * 4;
                    const directionY = (spawnY - rect.height / 2) * 4;

                    sparkle.style.setProperty('--x', `${directionX}px`);
                    sparkle.style.setProperty('--y', `${directionY}px`);
                    sparkle.style.setProperty('--r', `${Math.random() * 720}deg`);
                    sparkle.style.setProperty('--duration', `${Math.random() * 15 + 10}s`);

                    sparkle.addEventListener('animationend', () => {
                        sparkle.remove();
                        currentParticles--;
                    });
                }
                setInterval(createSparkle, 100);
            });
        }
           // Dados das per√≠cias para o seletor
        const periciasData = {
            "üèÉ‚Äç‚ôÇÔ∏è AGILIDADE": {
                "Acrobacia": "Capacidade de realizar movimentos √°geis e controlados com o corpo. Permite executar saltos, rolamentos, cambalhotas, equilibrar-se em superf√≠cies estreitas (como cordas ou parapeitos), escapar de armadilhas com destreza, e cair de grandes alturas sem se machucar seriamente. Muito usada por ladinos, artistas de circo, ladr√µes e monges guerreiros.",
                "Iniciativa": "Esta per√≠cia representa a velocidade de rea√ß√£o de um personagem quando o combate come√ßa. Um personagem com alta Iniciativa √© mais r√°pido para perceber o perigo e tomar uma a√ß√£o decisiva antes dos demais. √â usada principalmente para determinar a ordem de a√ß√µes no in√≠cio dos combates.",
                "Montaria": "Controle de ve√≠culos e montarias complexas. Essa per√≠cia mede a habilidade do personagem em conduzir carruagens, tren√≥s, navios, dirig√≠veis m√°gicos ou bestas voadoras/domadas. Pode abranger desde cavalgar grifos at√© manejar uma biga em alta velocidade. Envolve coordena√ß√£o, controle e capacidade de rea√ß√£o sob press√£o. (Somente Treinada)",
                "Furtividade": "A arte de mover-se sem ser notado. Esta per√≠cia cobre tanto o andar silencioso quanto a habilidade de esconder-se nas sombras, atr√°s de objetos ou em multid√µes. Ideal para emboscadas, fugas furtivas ou infiltra√ß√µes em ambientes hostis. O menor ru√≠do pode denunciar sua presen√ßa e selar seu destino.",
                "Pontaria": "Precis√£o com armas de longo alcance. Pontaria mede a capacidade do personagem de mirar e disparar com efic√°cia proj√©teis, como flechas, virotes, lan√ßas arremessadas, dardos, pedras de funda ou at√© mesmo artefatos m√°gicos de disparo. √â uma per√≠cia essencial para arqueiros, ca√ßadores e guerreiros de cerco. Voc√™ usa Pontaria para fazer ataques √† dist√¢ncia. Se passar na Classe de Armadura (CA) do alvo, voc√™ acerta e causa dano de acordo com a arma utilizada.",
                "Ladinagem": "Manipula√ß√£o veloz e precisa com as m√£os. Englobando truques de ilusionismo, carteado, pequenas trapa√ßas, furto de bolsos e a√ß√µes r√°pidas com objetos (como sacar uma arma oculta ou plantar algo em algu√©m). Em um mundo de m√°gicas e mist√©rios, √© o talento dos charlat√£es, trapaceiros e artistas de rua. (Somente Treinada)",
                "Reflexos": "Rapidez em reagir a est√≠mulos. Envolve esquiva de ataques, defesa contra armadilhas ativadas subitamente, rea√ß√µes a eventos inesperados e a√ß√µes de reflexo. Um reflexo afiado pode significar escapar de uma flecha ou agarrar algo antes de cair num abismo. Rea√ß√£o ‚ÄúEsquiva‚Äù. Sempre que estiver em um combate, e escolher a rea√ß√£o ‚ÄúEsquiva‚Äù‚Äô voc√™ soma o b√¥nus de seu Reflexos em sua Classe de Armadura (CA)."
            },
            "‚ú® CARISMA": {
                "Adestramento": "Treinamento e comando de animais. Esta per√≠cia representa a capacidade de domar, treinar, acalmar e comandar criaturas animais, desde cavalos e c√£es at√© bestas selvagens ou criaturas m√°gicas domestic√°veis, como lobos-fantasma, grifos ou wyverns. Com Adestramento, um personagem pode ensinar truques, manter a calma de um animal em situa√ß√µes de estresse, ou at√© us√°-lo em combate. (Somente Treinada)",
                "Engana√ß√£o": "A arte de manipular a verdade. Seja por mentiras diretas, disfarces convincentes ou atua√ß√£o dram√°tica, quem domina a engana√ß√£o consegue escapar de interrogat√≥rios, roubar com ast√∫cia ou seduzir com falsidade. Um talento sombrio, mas poderoso.",
                "Intimida√ß√£o": "Uso da for√ßa de personalidade para impor medo. Pode envolver amea√ßas veladas, posturas dominantes, gritos ou gestos agressivos. Serve tanto em interrogat√≥rios quanto em negocia√ß√µes tensas. Uma ferramenta dos brutais, ou dos desesperados.",
                "Persuas√£o": "A habilidade de influenciar e inspirar. Persuas√£o √© usada para negociar paz, inspirar aliados, convencer multid√µes ou manipular emo√ß√µes. √â a arma dos reis, sacerdotes, l√≠deres e diplomatas. Carisma n√£o √© s√≥ beleza, √© poder de alma."
            },
            "üß† INTELIG√äNCIA": {
                "Arcanismo": "Conhecimento te√≥rico e pr√°tico das artes m√≠sticas. Permite identificar feiti√ßos, decifrar runas arcanas, compreender grim√≥rios, detectar perturba√ß√µes m√°gicas e avaliar a origem de encantamentos. Magos, feiticeiros, s√°bios e escribas dependem desta per√≠cia para navegar pelo tecido da realidade. (Somente treinada)",
                "Hist√≥ria": "Mem√≥ria de tempos antigos. Conhecimento sobre civiliza√ß√µes passadas, linhagens nobres, guerras hist√≥ricas, ru√≠nas esquecidas e lendas ancestrais. Essencial para compreender o passado e como ele molda o presente. Os bardos e estudiosos valorizam muito essa habilidade.",
                "Investiga√ß√£o": "Capacidade de analisar cen√°rios, reunir pistas, cruzar informa√ß√µes e chegar a conclus√µes l√≥gicas. Essencial em investiga√ß√µes de assassinato, quebra-cabe√ßas antigos, armadilhas complexas ou tramas ocultas. Aqueles que buscam verdades escondidas s√£o mestres em investiga√ß√£o.",
                "Of√≠cio": "Cria√ß√£o, manuten√ß√£o e reparo de objetos f√≠sicos. Of√≠cio representa o conhecimento t√©cnico e pr√°tico de um personagem em artesanato, manufatura e produ√ß√£o de bens materiais. √â uma per√≠cia ampla, que abrange diferentes especializa√ß√µes, como carpintaria, forja, alquimia, ourivesaria, tesselagem, cer√¢mica, etc. Pode ser usada para: Criar itens como armas, armaduras, po√ß√µes, ferramentas, joias ou obras de arte. Reparar equipamentos danificados ou enfraquecidos. Avaliar a qualidade e o valor de objetos artesanais. Fornecer rendimentos com trabalho durante tempos de descanso ou entre aventuras. Nota: o jogador deve especificar qual tipo de of√≠cio domina ao investir nessa per√≠cia (Ex: Of√≠cio (Ferreiro), Of√≠cio (Alquimista), Of√≠cio (Carpinteiro), Of√≠cio (Cervejeiro), etc). O Mestre pode permitir generaliza√ß√µes caso apropriado. (Somente treinada)",
                "Religi√£o": "Conhecimento sobre divindades, dogmas, rituais, cultos e s√≠mbolos sagrados ou profanos. Permite reconhecer pr√°ticas religiosas, interpretar escrituras, compreender profecias e resistir a corrup√ß√µes espirituais. Cl√©rigos, inquisidores e ocultistas t√™m na religi√£o seu campo de estudo. (Somente treinada)",
                "Tecnologia": "Compreens√£o de mecanismos, engrenagens, armas de p√≥lvora, m√°quinas, golems ou aut√¥matos. Serve para desmontar, sabotar ou construir engenhocas, desativar dispositivos complexos ou consertar artefatos arcanomec√¢nicos. Ideal para inventores, art√≠fices e engenheiros arcanos."
            },
            "üèãÔ∏è FOR√áA": {
                "Atletismo": "Medida da for√ßa bruta aplicada com t√©cnica. Escalar penhascos, nadar em correntezas, arrombar portas, correr longas dist√¢ncias, saltar abismos e resistir ao cansa√ßo f√≠sico s√£o exemplos do uso de Atletismo. Guerreiros, b√°rbaros e aventureiros de corpo robusto s√£o peritos nessa per√≠cia.",
                "Luta": "Combate corpo a corpo com armas simples, improvisadas ou sem t√©cnica refinada. Diferente de ‚ÄúPontaria‚Äù, Luta cobre o combate bruto e direto, incluindo socos, chutes, agarr√µes, cabe√ßadas ou o uso de objetos improvisados como armas. Um personagem que cresceu brigando em tavernas, ringues clandestinos ou treinado em pancadaria usaria Luta. Pode tamb√©m ser usada em situa√ß√µes de agarr√£o, desarme ou quando estiver desarmado. Voc√™ usa Luta para fazer ataques corpo a corpo. Se passar na Classe de Armadura (CA) do alvo, voc√™ acerta e causa dano de acordo com a arma utilizada. Rea√ß√£o ‚ÄúBloqueio‚Äù. Sempre que estiver em um combate, e escolher a rea√ß√£o ‚ÄúBloqueio‚Äù‚Äô voc√™ soma o b√¥nus de seu Luta em sua Classe de Armadura (CA)."
            },
            "ü¶â SABEDORIA": {
                "Intui√ß√£o": "Habilidade de ler emo√ß√µes, detectar mentiras, perceber inten√ß√µes ocultas ou sentir m√°s vibra√ß√µes. Intui√ß√£o √© o instinto afinado que diz quando algo est√° errado, mesmo sem provas. Empatas, inquisidores e detetives sens√≠veis dominam esta arte.",
                "Percep√ß√£o": "Capacidade de notar detalhes ao redor. Envolve detectar armadilhas, ouvir passos distantes, sentir cheiros suspeitos, ver al√©m do √≥bvio. Percep√ß√£o √© a vigil√¢ncia constante dos sentidos. Ca√ßadores e sentinelas contam com ela para sobreviver.",
                "Medicina": "Conhecimento de curas, ervas, tratamento de feridas, estabiliza√ß√£o de moribundos, identifica√ß√£o de doen√ßas e venenos. Em tempos onde magia curativa nem sempre est√° dispon√≠vel, a medicina pode ser a diferen√ßa entre a vida e a morte. Primeiros Socorros (CD 20). Um personagem adjacente que esteja morrendo e inconsciente perde essas condi√ß√µes e fica com 1 PV. A CD aumenta em +5 para cada vez que ele tiver sido estabilizado na cena. Este uso gasta uma a√ß√£o padr√£o. (Somente Treinada)",
                "Natureza": "Sabedoria sobre o mundo natural. Inclui plantas, animais, clima, ecossistemas e perigos naturais. Ajuda a identificar criaturas selvagens, prever tempestades, encontrar ervas raras ou rastrear seres no mato. Druidas, ca√ßadores e herbalistas s√£o mestres nesta √°rea.",
                "Sobreviv√™ncia": "A per√≠cia de se adaptar aos perigos do mundo selvagem. Desde acender fogueiras, montar acampamentos, ca√ßar e rastrear presas at√© prever perigos naturais ou evitar √°reas amaldi√ßoadas. Uma habilidade vital para quem trilha caminhos fora das cidades ou foge delas.",
                "Vontade": "Representa a for√ßa interior e a estabilidade emocional. Resistir a encantamentos, manter a sanidade diante do horror, resistir a tortura ps√≠quica, controlar impulsos destrutivos e manter-se fiel a seus ideais mesmo diante da corrup√ß√£o. Monges, m√°rtires e paladinos s√£o exemplo de mentes inquebrant√°veis."
            },
            "‚ù§Ô∏è VIGOR": {
                "Fortitude": "Representa a resist√™ncia f√≠sica e imunol√≥gica do personagem. √â a capacidade de resistir a doen√ßas, venenos, fadiga extrema, torturas, fome e frio intenso. Tamb√©m usada em testes de esfor√ßo corporal cont√≠nuo, como manter-se consciente ap√≥s ferimentos graves."
            }
        };
        document.addEventListener('DOMContentLoaded', () => {
            const cardForm = document.getElementById('cardForm');
            const cardsContainer = document.getElementById('cardsContainer');
            const submitButton = document.getElementById('submitButton');
            const thumbnailList = document.getElementById('thumbnail-list');

            const cardTitleInput = document.getElementById('cardTitle');
            const cardSubTitleInput = document.getElementById('cardSubTitle');
            const cardLevelInput = document.getElementById('cardLevel');

            const characterImageUpload = document.getElementById('characterImageUpload');
            const backgroundImageUpload = document.getElementById('backgroundImageUpload');
            const characterImagePreview = document.getElementById('characterImagePreview');
            const backgroundImagePreview = document.getElementById('backgroundImagePreview');
            
            const agilidadeInput = document.getElementById('agilidade');
            const manaInput = document.getElementById('mana');
            const vidaInput = document.getElementById('vida');
            const carismaInput = document.getElementById('carisma');
            const forcaInput = document.getElementById('forca');
            const inteligenciaInput = document.getElementById('inteligencia');
            const sabedoriaInput = document.getElementById('sabedoria');
            const vigorInput = document.getElementById('vigor');
            
            const periciasCheckboxesContainer = document.getElementById('pericias-checkboxes-container');
            const periciaDescriptionTitle = document.getElementById('periciaDescriptionTitle');
            const periciaDescriptionText = document.getElementById('periciaDescriptionText');
            const periciaDescriptionDisplay = document.getElementById('pericia-description-display');

            // Novos elementos da tela de splash
            const splashScreen = document.getElementById('splashScreen');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const mainContent = document.getElementById('mainContent');
            const loadingMessages = [
                'Invocando o Grim√≥rio...',
                'Forjando Cart√µes...',
                'Organizando o Invent√°rio...',
                'Sincronizando com os Reinos...'
            ];

            function showSplash() {
                splashScreen.classList.remove('hidden');
                mainContent.classList.add('hidden');
                progressBar.style.width = '0%';
                progressText.textContent = 'Iniciando aventura...';
            }

            function updateProgress(percentage, message) {
                progressBar.style.width = `${percentage}%`;
                if (message) {
                    progressText.textContent = `${message} (${percentage}%)`;
                }
            }

            function hideSplash() {
                splashScreen.classList.add('hidden');
                mainContent.classList.remove('hidden');
            }

            function populatePericiasCheckboxes() {
                periciasCheckboxesContainer.innerHTML = '';
                
                for (const attribute in periciasData) {
                    if (periciasData.hasOwnProperty(attribute)) {
                        const details = document.createElement('details');
                        details.className = 'bg-gray-700 rounded-lg p-2 transition-all duration-300';
                        details.innerHTML = `
                            <summary class="flex items-center justify-between cursor-pointer font-semibold text-indigo-200">
                                <span>${attribute}</span>
                                <svg class="w-4 h-4 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                </svg>
                            </summary>
                            <div class="mt-2 space-y-2 pl-4 border-l border-gray-600 pericias-list"></div>
                        `;
                        
                        const periciasList = details.querySelector('.pericias-list');
                        details.querySelector('summary').addEventListener('click', () => {
                            setTimeout(() => {
                                details.querySelector('svg').style.transform = details.open ? 'rotate(90deg)' : 'rotate(0deg)';
                            }, 300);
                        });

                        for (const periciaName in periciasData[attribute]) {
                            if (periciasData[attribute].hasOwnProperty(periciaName)) {
                                const periciaItem = document.createElement('div');
                                periciaItem.className = 'flex items-center pericia-item rounded-md p-1 cursor-pointer';
                                periciaItem.innerHTML = `
                                    <input type="checkbox" id="pericia-${periciaName.replace(/\s+/g, '-')}" name="pericia" value="${periciaName}"
                                           class="form-checkbox h-4 w-4 text-indigo-500 rounded border-gray-600 focus:ring-indigo-500">
                                    <label for="pericia-${periciaName.replace(/\s+/g, '-')}" class="ml-2 text-sm text-gray-200 cursor-pointer">${periciaName}</label>
                                `;
                                periciasList.appendChild(periciaItem);

                                periciaItem.addEventListener('click', (e) => {
                                    if (e.target.tagName !== 'INPUT') {
                                        const checkbox = periciaItem.querySelector('input');
                                        checkbox.checked = !checkbox.checked;
                                    }
                                    periciaDescriptionTitle.textContent = periciaName;
                                    periciaDescriptionText.textContent = periciasData[attribute][periciaName];
                                    periciaDescriptionDisplay.classList.remove('hidden');
                                });
                            }
                        }
                        periciasCheckboxesContainer.appendChild(details);
                    }
                }
            }

            let currentEditingCardId = null;
            let mySwiper = null;
            let db;
            const DB_NAME = 'rpgCardCreatorDB';
            const DB_VERSION = 1;
            const STORE_NAME = 'rpgCards';
            let characterImageUrl = '';
            let backgroundImageUrl = '';
            let characterImageFile = null;
            let backgroundImageFile = null;

            function bufferToBlob(buffer, mimeType) {
                return new Blob([buffer], { type: mimeType });
            }

            function rgbToHsl(r, g, b) {
                r /= 255; g /= 255; b /= 255;
                let max = Math.max(r, g, b), min = Math.min(r, g, b);
                let h, s, l = (max + min) / 2;
                if (max === min) {
                    h = s = 0;
                } else {
                    let d = max - min;
                    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                    switch (max) {
                        case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                        case g: h = (b - r) / d + 2; break;
                        case b: h = (r - g) / d + 4; break;
                    }
                    h /= 6;
                }
                return [h, s, l];
            }

            function hslToRgb(h, s, l) {
                let r, g, b;
                if (s === 0) {
                    r = g = b = l;
                } else {
                    const hue2rgb = (p, q, t) => {
                        if (t < 0) t += 1;
                        if (t > 1) t -= 1;
                        if (t < 1 / 6) return p + (q - p) * 6 * t;
                        if (t < 1 / 2) return q;
                        if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;
                        return p;
                    };
                    const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                    const p = 2 * l - q;
                    r = hue2rgb(p, q, h + 1 / 3);
                    g = hue2rgb(p, q, h);
                    b = hue2rgb(p, q, h - 1 / 3);
                }
                return `rgb(${Math.round(r * 255)}, ${Math.round(g * 255)}, ${Math.round(b * 255)})`;
            }

            function getPredominantColorAndPalette(imageUrl) {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.crossOrigin = "Anonymous";
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0, img.width, img.height);
                        
                        try {
                            const imageData = ctx.getImageData(0, 0, img.width, img.height).data;
                            let r = 0, g = 0, b = 0, count = 0;
                            const step = 4 * 10;
                            for (let i = 0; i < imageData.length; i += step) {
                                r += imageData[i];
                                g += imageData[i + 1];
                                b += imageData[i + 2];
                                count++;
                            }

                            const avgR = Math.floor(r / count);
                            const avgG = Math.floor(g / count);
                            const avgB = Math.floor(b / count);
                            let [h, s, l] = rgbToHsl(avgR, avgG, avgB);
                            const isLightBackground = l > 0.5;
                            const textColor = isLightBackground ? 'rgb(31, 41, 55)' : 'rgb(243, 244, 246)';
                            const cardBg = isLightBackground ? 'rgba(255, 255, 255, 0.8)' : 'rgba(31, 41, 55, 0.9)';

                            const palette = {
                                cardBg: cardBg,
                                highlightColor: hslToRgb(h, Math.min(s * 1.5, 1), isLightBackground ? Math.max(l * 0.7, 0.3) : Math.min(l * 1.5, 0.7)),
                                textColor: textColor,
                                borderColor: hslToRgb(h, s, isLightBackground ? Math.max(l * 0.7, 0.3) : Math.min(l * 1.5, 0.7)),
                            };
                            
                            resolve(palette);
                        } catch (e) {
                            console.error('Erro ao processar imagem para paleta:', e);
                            reject(e);
                        }
                    };
                    img.onerror = (e) => reject(e);
                    img.src = imageUrl;
                });
            }

            function openDatabase() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(DB_NAME, DB_VERSION);
                    request.onsuccess = (event) => {
                        db = event.target.result;
                        console.log('IndexedDB aberto com sucesso');
                        resolve(db);
                    };
                    request.onerror = (event) => {
                        console.error('Erro ao abrir o IndexedDB:', event.target.error);
                        reject(event.target.error);
                    };
                    request.onupgradeneeded = (event) => {
                        db = event.target.result;
                        if (!db.objectStoreNames.contains(STORE_NAME)) {
                            db.createObjectStore(STORE_NAME, { keyPath: 'id' });
                            console.log('Object store criado com sucesso.');
                        }
                    };
                });
            }

            async function saveCard(cardData) {
                const transaction = db.transaction([STORE_NAME], 'readwrite');
                const store = transaction.objectStore(STORE_NAME);
                
                return new Promise((resolve, reject) => {
                    const request = store.put(cardData);
                    request.onsuccess = () => {
                        console.log('Cart√£o salvo no IndexedDB.');
                        resolve();
                    };
                    request.onerror = (event) => {
                        console.error('Erro ao salvar cart√£o:', event.target.error);
                        reject(event.target.error);
                    };
                });
            }

            async function getCards() {
                const transaction = db.transaction([STORE_NAME], 'readonly');
                const store = transaction.objectStore(STORE_NAME);

                return new Promise((resolve, reject) => {
                    const request = store.getAll();
                    request.onsuccess = (event) => {
                        resolve(event.target.result);
                    };
                    request.onerror = (event) => {
                        console.error('Erro ao obter cart√µes:', event.target.error);
                        reject(event.target.error);
                    };
                });
            }

            async function removeCardFromDB(cardId) {
                const transaction = db.transaction([STORE_NAME], 'readwrite');
                const store = transaction.objectStore(STORE_NAME);
                return new Promise((resolve, reject) => {
                    const request = store.delete(cardId);
                    request.onsuccess = () => {
                        console.log('Cart√£o removido do IndexedDB.');
                        resolve();
                    };
                    request.onerror = (event) => {
                        console.error('Erro ao remover cart√£o:', event.target.error);
                        reject(event.target.error);
                    };
                });
            }

            function initSwiper() {
                if (mySwiper) {
                    mySwiper.destroy(true, true);
                }
                mySwiper = new Swiper('.mySwiper', {
                    slidesPerView: 1,
                    spaceBetween: 30,
                    loop: false,
                    pagination: {
                        el: '.swiper-pagination',
                        clickable: true,
                    },
                    navigation: {
                        nextEl: '.swiper-button-next',
                        prevEl: '.swiper-button-prev',
                    },
                });
            }

            async function editCard(cardId) {
                const allCards = await getCards();
                const cardData = allCards.find(card => card.id === cardId);
                if (!cardData) return;
                
                currentEditingCardId = cardId;
                
                cardTitleInput.value = cardData.title;
                cardSubTitleInput.value = cardData.subTitle;
                cardLevelInput.value = cardData.level;
                agilidadeInput.value = cardData.attributes.agilidade;
                manaInput.value = cardData.attributes.mana;
                vidaInput.value = cardData.attributes.vida;
                carismaInput.value = cardData.attributes.carisma;
                forcaInput.value = cardData.attributes.forca;
                inteligenciaInput.value = cardData.attributes.inteligencia;
                sabedoriaInput.value = cardData.attributes.sabedoria;
                vigorInput.value = cardData.attributes.vigor;

                document.querySelectorAll('#pericias-checkboxes-container input[type="checkbox"]').forEach(cb => cb.checked = false);
                if (Array.isArray(cardData.attributes.pericias)) {
                    cardData.attributes.pericias.forEach(periciaName => {
                        const checkbox = document.getElementById(`pericia-${periciaName.replace(/\s+/g, '-')}`);
                        if (checkbox) checkbox.checked = true;
                    });
                }

                if (cardData.image) {
                    const imageBlob = bufferToBlob(cardData.image, cardData.imageMimeType);
                    characterImageUrl = URL.createObjectURL(imageBlob);
                    showImagePreview(characterImagePreview, characterImageUrl, true);
                    characterImageFile = null;
                } else {
                    characterImageUrl = '';
                    showImagePreview(characterImagePreview, null, true);
                }

                if (cardData.backgroundImage) {
                    const backgroundBlob = bufferToBlob(cardData.backgroundImage, cardData.backgroundMimeType);
                    backgroundImageUrl = URL.createObjectURL(backgroundBlob);
                    showImagePreview(backgroundImagePreview, backgroundImageUrl, false);
                } else {
                    backgroundImageUrl = '';
                    showImagePreview(backgroundImagePreview, null, false);
                }

                characterImageUpload.value = null;
                backgroundImageUpload.value = null;

                submitButton.textContent = 'Salvar Edi√ß√£o';
                submitButton.classList.remove('btn-gradient-pulse');
            }

            async function renderCardsAndThumbnails() {
                cardsContainer.innerHTML = '';
                thumbnailList.innerHTML = '';
                
                const allCards = await getCards();
                
                if (allCards.length === 0) {
                    thumbnailList.innerHTML = '<p class="text-gray-500 text-center w-full">Nenhum cart√£o salvo ainda. Crie um para come√ßar!</p>';
                } else {
                    let cardsLoaded = 0;
                    const totalCards = allCards.length;
                    
                    for (const cardData of allCards) {
                        let imageURL = 'https://placehold.co/160x160/E5E7EB/4B5563?text=Personagem';
                        let backgroundURL = 'https://placehold.co/400x600/1e293b/d1d5db?text=Fundo+do+Cart√£o';

                        if (cardData.image && cardData.imageMimeType) {
                            const imageBlob = bufferToBlob(cardData.image, cardData.imageMimeType);
                            imageURL = URL.createObjectURL(imageBlob);
                        }
                        if (cardData.backgroundImage && cardData.backgroundMimeType) {
                            const backgroundBlob = bufferToBlob(cardData.backgroundImage, cardData.backgroundMimeType);
                            backgroundURL = URL.createObjectURL(backgroundBlob);
                        }

                        const cardWrapper = await createCardElement({...cardData, imageURL, backgroundURL});
                        cardsContainer.appendChild(cardWrapper);
                        
                        const thumbnail = createThumbnailElement({...cardData, imageURL, backgroundURL});
                        thumbnailList.appendChild(thumbnail);
                        
                        cardsLoaded++;
                        const percentage = Math.round((cardsLoaded / totalCards) * 100);
                        updateProgress(percentage, loadingMessages[Math.floor(Math.random() * loadingMessages.length)]);
                    }
                }
                initSwiper();
                part();
                setTimeout(hideSplash, 1000); // Esconde a tela de splash ap√≥s 1 segundo
            }

            async function createCardElement(cardData) {
                const cardWrapper = document.createElement('div');
                cardWrapper.className = 'swiper-slide card-wrapper flex flex-col items-center gap-4';
                const cardDiv = document.createElement('div');
                cardDiv.className = 'w-full h-auto rounded-3xl shadow-2xl rpg-card';
                cardDiv.dataset.cardId = cardData.id;
                cardDiv.style.backgroundImage = `url(${cardData.backgroundURL})`;
                let palette = {
                    cardBg: 'rgba(31, 41, 55, 0.9)',
                    highlightColor: '#6366f1',
                    textColor: '#e5e7eb',
                    borderColor: '#4b5563'
                };
                if (cardData.backgroundURL && !cardData.backgroundURL.includes('placehold.co')) {
                    try {
                        palette = await getPredominantColorAndPalette(cardData.backgroundURL);
                    } catch (e) {
                        console.error('Falha ao gerar paleta de cores, usando padr√£o.', e);
                    }
                }
                const periciasString = Array.isArray(cardData.attributes.pericias) && cardData.attributes.pericias.length > 0
                            ? cardData.attributes.pericias.join(', ')
                            : 'Nenhuma';
                cardDiv.innerHTML = `
                <div class="card-3d-container">
                    <div class="card-3d divPartculas">
                        <div class="card-front" style="border-color: ${palette.borderColor}">
                            <div class=" rounded-3xl relative w-full h-full p-4 ex-max" style="background-image:url(${cardData.backgroundURL}) !important; background-size: cover !important; height: 600px; display: flex; flex-direction: column; align-items: center; background-color: rgb(0 0 0 / 50%); background-blend-mode: multiply; justify-content: space-between;">
                                <div class="absolute top-4 left-4 rounded-full w-14 h-14 flex items-center justify-center font-bold" style="z-index: 1; border: 2px solid ${palette.highlightColor}; background-color: #1f2937; color: ${palette.textColor}; display: flex; flex-direction: column; justify-content: center; padding: 5px; align-content: center; align-items: center;">
                                    <small style="background: #1f2937; border: 2px solid ${palette.highlightColor}; border-bottom: 0; border-right: 0;">PM</small>
                                    ${cardData.attributes.mana || '?'} 
                                </div>
                                <div class="absolute top-4 right-4 rounded-full w-14 h-14 flex items-center justify-center font-bold" style="z-index: 1;border: 2px solid ${palette.highlightColor}; background-color: #1f2937; color: ${palette.textColor}; display: flex; flex-direction: column; justify-content: center; padding: 5px; align-content: center; align-items: center;">
                                    <small  style="background: #1f2937; left: auto; right: -10px;  border: 2px solid ${palette.highlightColor}; border-bottom: 0; border-left: 0;"">PV</small>
                                    ${cardData.attributes.vida || '?'} 
                                </div>
                                <div class="text-center" style="width: 60%;">
                                    <h3 class="text-2xl font-bold" style="color: ${palette.highlightColor};">${cardData.title || 'Novo Cart√£o'}</h3>
                                    <div class="rpg-card-title-divider" style="background: linear-gradient(to right, transparent, ${palette.borderColor}, transparent); width: 100%"></div>
                                    <p class="text-sm italic" style="color: ${palette.highlightColor};">${cardData.subTitle || 'Subt√≠tulo'}</p>
                                </div>
                                <div class="wave-container flex justify-center img-max" style="position: relative; width: 200px !important; height: 200px;">
                                    <img style="border-color: ${palette.borderColor}; z-index: 1; height: 200px" src="${cardData.imageURL}" onerror="this.onerror=null;this.src='https://placehold.co/160x160/E5E7EB/4B5563?text=Personagem';" alt="Imagem do personagem" class="object-cover rounded-full border-4 border-white shadow-lg w-full h-full">
                                </div>
                                <div class="p-3 rounded-3xl text-center w-full rpg-card-frame" style="--card-bg-color: ${palette.cardBg}; z-index: 1; --text-color: ${palette.textColor}; --border-color: ${palette.borderColor};">
                                    <h4 class="text-base font-bold" style="color: ${palette.textColor};">N√≠vel: <span style="color: ${palette.highlightColor};">${cardData.level || '?'}</span></h4>
                                    <div class="flex items-center justify-center w-full">
                                        <div class="rpg-card-title-divider" style="background: linear-gradient(to right, transparent, ${palette.borderColor}, transparent);"></div>
                                    </div>
                                    
                                    <div class="mt-2 flex flex-col space-y-2 text-xs">
                                        <div class="flex items-center space-x-2">
                                            <span class="font-bold">AGI</span>
                                            <div class="stat-bar flex-grow" style="margin-top: 0">
                                                <div class="stat-fill" style="width: ${(cardData.attributes.agilidade * 100)/ 3}%; background: ${palette.borderColor}"></div>
                                            </div>
                                            <span class="text-xs font-bold ml-auto">${cardData.attributes.agilidade} / 3</span>
                                        </div>                                   
                                    </div>
                                    <div class="mt-2 flex flex-col space-y-2 text-xs">
                                        <div class="flex items-center space-x-2">
                                            <span class="font-bold">CAR</span>
                                            <div class="stat-bar flex-grow" style="margin-top: 0">
                                                <div class="stat-fill" style="width: ${(cardData.attributes.carisma * 100) / 3}%; background: ${palette.borderColor}"></div>
                                            </div>
                                            <span class="text-xs font-bold ml-auto">${cardData.attributes.carisma} / 3</span>
                                        </div>                                   
                                    </div>
                                    <div class="mt-2 flex flex-col space-y-2 text-xs">
                                        <div class="flex items-center space-x-2">
                                            <span class="font-bold">FOR</span>
                                            <div class="stat-bar flex-grow" style="margin-top: 0">
                                                <div class="stat-fill" style="width: ${(cardData.attributes.forca * 100) / 3}%; background: ${palette.borderColor}"></div>
                                            </div>
                                            <span class="text-xs font-bold ml-auto">${cardData.attributes.forca} / 3</span>
                                        </div>                                   
                                    </div>
                                    <div class="mt-2 flex flex-col space-y-2 text-xs">
                                        <div class="flex items-center space-x-2">
                                            <span class="font-bold">INT</span>
                                            <div class="stat-bar flex-grow" style="margin-top: 0">
                                                <div class="stat-fill" style="width: ${(cardData.attributes.inteligencia * 100) / 3}%; background: ${palette.borderColor}"></div>
                                            </div>
                                            <span class="text-xs font-bold ml-auto">${cardData.attributes.inteligencia} / 3</span>
                                        </div>                                   
                                    </div>
                                    <div class="mt-2 flex flex-col space-y-2 text-xs">
                                        <div class="flex items-center space-x-2">
                                            <span class="font-bold">SAB</span>
                                            <div class="stat-bar flex-grow" style="margin-top: 0">
                                                <div class="stat-fill" style="width: ${(cardData.attributes.sabedoria * 100) / 3}%; background: ${palette.borderColor}"></div>
                                            </div>
                                            <span class="text-xs font-bold ml-auto">${cardData.attributes.sabedoria} / 3</span>
                                        </div>                                   
                                    </div>
                                    <div class="mt-2 flex flex-col space-y-2 text-xs">
                                        <div class="flex items-center space-x-2">
                                            <span class="font-bold">VIG</span>
                                            <div class="stat-bar flex-grow" style="margin-top: 0">
                                                <div class="stat-fill" style="width: ${(cardData.attributes.vigor * 100) / 3}%; background: ${palette.borderColor}"></div>
                                            </div>
                                            <span class="text-xs font-bold ml-auto">${cardData.attributes.vigor} / 3</span>
                                        </div>                                   
                                    </div>
                                    <div class="flex flex-col gap-2">                                       
                                        <div class="flex items-center justify-center w-full">
                                            <div class="rpg-card-title-divider" style="background: linear-gradient(to right, transparent, ${palette.borderColor}, transparent);"></div>
                                        </div>
                                        <p class="text-xs text-gray-400 italic">Per√≠cias</p>                                      
                                        <p class="text-xs text-gray-400 italic" style="font-size: 11px;">${periciasString}</p>                                   
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-back divPartculas" style="background-image:url(${cardData.backgroundURL}) !important; background-size: cover !important; background-color: rgb(0 0 0 / 50%);background-blend-mode: multiply;">
                            <div class="back-content " style="border: 5px solid ${palette.borderColor};">
                                <h2></h2>
                                <p></p>
                            </div>
                        </div>
                    </div>
                </div> `;
                
                const buttonsDiv = document.createElement('div');
                buttonsDiv.className = 'flex justify-center space-x-2 w-full';
                buttonsDiv.innerHTML = `
                    <button class="w-1/3 py-3 px-4 rounded-full text-sm font-bold text-white bg-indigo-500 hover:bg-indigo-600 transition-colors duration-200 edit-btn" data-card-id="${cardData.id}" style="border-radius: 50px 0px 0px 50px; background-color: ${palette.cardBg};">
                        Editar
                    </button>
                    <button class="w-1/3 py-3 px-4 rounded-full text-sm font-bold text-white bg-red-500 hover:bg-red-600 transition-colors duration-200 remove-btn" data-card-id="${cardData.id}"  style="border-radius: 0; background-color: ${palette.highlightColor};">
                        Excluir
                    </button>
                    <button class="w-1/3 py-3 px-4 rounded-full text-sm font-bold text-white bg-purple-500 hover:bg-purple-600 transition-colors duration-200 fullscreen-btn" data-card-id="${cardData.id}" style="border-radius: 0px 50px 50px 0px; background-color: ${palette.cardBg};">
                        Expandir
                    </button>
                `;

                cardWrapper.appendChild(cardDiv);
                const card3d = cardDiv.querySelector('.card-3d');
                if (card3d) {
                    card3d.addEventListener('click', () => {
                        if (card3d.style.transform === 'rotateY(180deg)') {
                            card3d.style.transform = 'rotateY(0deg)';
                        } else {
                            card3d.style.transform = 'rotateY(180deg)';
                        }
                    });

                    card3d.addEventListener('mousemove', (e) => {
                        const rect = card3d.getBoundingClientRect();
                        const x = e.clientX - rect.left - rect.width / 2;
                        const y = e.clientY - rect.top - rect.height / 2;
                        const rotateX = (-y / rect.height) * 20;
                        const rotateY = (x / rect.width) * 20;
                        card3d.style.transform = `rotateY(${rotateY}deg) rotateX(${rotateX}deg)`;
                    });

                    card3d.addEventListener('mouseleave', () => {
                        card3d.style.transform = 'rotateY(0deg) rotateX(0deg)';
                    });
                }
                cardWrapper.appendChild(buttonsDiv);
                return cardWrapper;
            }

            function createThumbnailElement(cardData) {
                const thumbnailWrapper = document.createElement('div');
                thumbnailWrapper.className = 'relative w-20 h-24 rounded-lg overflow-hidden shadow-lg border-2 border-gray-400 cursor-pointer hover:border-indigo-500 transition-colors duration-200';
                thumbnailWrapper.dataset.cardId = cardData.id;
                thumbnailWrapper.style.backgroundImage = `url(${cardData.backgroundURL})`;
                thumbnailWrapper.style.backgroundSize = 'cover';
                thumbnailWrapper.style.backgroundPosition = 'center';
                thumbnailWrapper.style.minWidth = '5rem';
                thumbnailWrapper.innerHTML = `
                    <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center">
                        <img src="${cardData.imageURL}" onerror="this.onerror=null;this.src='https://placehold.co/40x40/E5E7EB/4B5563?text=P';" alt="Miniatura do personagem" class="w-10 h-10 object-cover rounded-full border-2 border-white">
                    </div>
                    <div class="absolute bottom-1 left-1 bg-gray-800 text-white text-xs px-2 py-1 rounded-full font-bold">
                        Lv.${cardData.level || '?'}
                    </div>
                `;
                thumbnailWrapper.addEventListener('click', async () => {
                    await editCard(cardData.id);
                    const allCards = await getCards();
                    const cardIndex = allCards.findIndex(c => c.id === cardData.id);
                    if (cardIndex !== -1) {
                        mySwiper.slideTo(cardIndex);
                    }
                });
                return thumbnailWrapper;
            }

            cardsContainer.addEventListener('click', async (e) => {
                const target = e.target;
                const buttonsDiv = target.closest('.buttons-div');
                const cardWrapper = target.closest('.card-wrapper');
                const cardDiv = cardWrapper ? cardWrapper.querySelector('.rpg-card') : null;
                const cardId = cardDiv ? cardDiv.dataset.cardId : null;
                if (!cardId) return;
                if (target.classList.contains('edit-btn')) {
                    await editCard(cardId);
                } else if (target.classList.contains('remove-btn')) {
                    await removeCard(cardId);
                } else if (target.classList.contains('fullscreen-btn')) {
                    if (document.fullscreenElement) {
                        document.exitFullscreen();
                    } else {
                        cardDiv.requestFullscreen().catch(err => {
                            console.error(`Erro ao entrar em modo de tela cheia: ${err.message}`);
                        });
                    }
                }
            });

            async function removeCard(cardId) {
                await removeCardFromDB(cardId);
                renderCardsAndThumbnails();
            }

            characterImageUpload.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    characterImageFile = file;
                    characterImageUrl = URL.createObjectURL(file);
                    showImagePreview(characterImagePreview, characterImageUrl, true);
                }
            });

            backgroundImageUpload.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    backgroundImageFile = file;
                    backgroundImageUrl = URL.createObjectURL(file);
                    showImagePreview(backgroundImagePreview, backgroundImageUrl, false);
                }
            });

            function showImagePreview(element, url, isImageElement) {
                if (url) {
                    if (isImageElement) {
                        element.src = url;
                    } else {
                        element.style.backgroundImage = `url(${url})`;
                    }
                    element.classList.remove('hidden');
                } else {
                    element.classList.add('hidden');
                }
            }

            function readFileAsArrayBuffer(file) {
                return new Promise((resolve, reject) => {
                    if (!file) {
                        resolve(null);
                        return;
                    }
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.onerror = (e) => reject(e.target.error);
                    reader.readAsArrayBuffer(file);
                });
            }

            cardForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const title = cardTitleInput.value;
                const subTitle = cardSubTitleInput.value;
                const level = cardLevelInput.value;
                const selectedPericias = Array.from(document.querySelectorAll('#pericias-checkboxes-container input[name="pericia"]:checked'))
                    .map(cb => cb.value);
                const attributes = {
                    agilidade: agilidadeInput.value || '-',
                    mana: manaInput.value || '-',
                    vida: vidaInput.value || '-',
                    carisma: carismaInput.value || '-',
                    forca: forcaInput.value || '-',
                    inteligencia: inteligenciaInput.value || '-',
                    sabedoria: sabedoriaInput.value || '-',
                    vigor: vigorInput.value || '-',
                    pericias: selectedPericias
                };
                let allCards = await getCards();
                let cardData;
                if (currentEditingCardId) {
                    cardData = allCards.find(card => card.id === currentEditingCardId);
                    if (!cardData) return;
                    cardData.title = title;
                    cardData.subTitle = subTitle;
                    cardData.level = level;
                    cardData.attributes = attributes;
                    if (characterImageFile) {
                        cardData.image = await readFileAsArrayBuffer(characterImageFile);
                        cardData.imageMimeType = characterImageFile.type;
                    }
                    if (backgroundImageFile) {
                        cardData.backgroundImage = await readFileAsArrayBuffer(backgroundImageFile);
                        cardData.backgroundMimeType = backgroundImageFile.type;
                    }
                    await saveCard(cardData);
                    currentEditingCardId = null;
                    submitButton.textContent = 'Criar Cart√£o';
                    submitButton.classList.add('btn-gradient-pulse');
                } else {
                    const newCardId = Date.now().toString();
                    const newCardData = { 
                        id: newCardId, 
                        title, 
                        subTitle, 
                        level, 
                        attributes 
                    };
                    if (characterImageFile) {
                        newCardData.image = await readFileAsArrayBuffer(characterImageFile);
                        newCardData.imageMimeType = characterImageFile.type;
                    }
                    if (backgroundImageFile) {
                        newCardData.backgroundImage = await readFileAsArrayBuffer(backgroundImageFile);
                        newCardData.backgroundMimeType = backgroundImageFile.type;
                    }
                    await saveCard(newCardData);
                }
                cardForm.reset();
                if (characterImageUrl) URL.revokeObjectURL(characterImageUrl);
                if (backgroundImageUrl) URL.revokeObjectURL(backgroundImageUrl);
                characterImageUrl = '';
                backgroundImageFile = null;
                backgroundImageFile = null;
                showImagePreview(characterImagePreview, null, true);
                showImagePreview(backgroundImagePreview, null, false);
                renderCardsAndThumbnails();
            });

            // Inicia o IndexedDB e depois renderiza os cart√µes, mostrando a tela de splash
            showSplash();
            openDatabase().then(() => {
                populatePericiasCheckboxes();
                renderCardsAndThumbnails();
            }).catch(e => {
                console.error("Falha ao inicializar o app:", e);
                hideSplash();
            });
        });
    </script>
</body>
</html>
